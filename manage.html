<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cursor é£ä¹¦æ¡¥æ¥ - å·¥ä½œç©ºé—´ä¸ä¼šè¯ç®¡ç†</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    h1 { margin-top: 0; color: #333; }
    h2 { color: #555; font-size: 1.1rem; margin-bottom: 12px; }
    section { background: #fff; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #fafafa; font-weight: 600; color: #555; }
    .path { font-family: ui-monospace, monospace; font-size: 0.9em; color: #666; word-break: break-all; }
    .btn { padding: 6px 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; }
    .btn-primary { background: #1a73e8; color: #fff; }
    .btn-primary:hover { background: #1557b0; }
    .btn-danger { background: #dc3545; color: #fff; }
    .btn-danger:hover { background: #c82333; }
    .form-row { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .form-row input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
    .form-row input[type="text"] { flex: 1; min-width: 200px; }
    .form-row input[type="number"] { width: 80px; }
    .empty { color: #999; padding: 20px; text-align: center; }
    .time { font-size: 0.9em; color: #666; }
    .refresh { margin-bottom: 12px; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; background: #e8f0fe; color: #1967d2; }
  </style>
</head>
<body>
  <h1>ğŸ“‚ Cursor é£ä¹¦æ¡¥æ¥ - ç®¡ç†</h1>
  <p style="color:#666;">å·¥ä½œç©ºé—´åˆ—è¡¨ä¸ Agent ä¼šè¯è®°å½•ã€‚åœ¨é£ä¹¦å‘é€ã€Œå·¥ä½œç©ºé—´ã€æŸ¥çœ‹åˆ—è¡¨ï¼Œå‘é€ã€Œå·¥ä½œç©ºé—´ 1ã€åˆ‡æ¢ã€‚</p>

  <section>
    <h2>å·¥ä½œç©ºé—´åˆ—è¡¨</h2>
    <div class="refresh">
      <button class="btn btn-primary" onclick="loadWorkspaces()">åˆ·æ–°</button>
    </div>
    <div class="form-row">
      <input type="text" id="wsName" placeholder="åç§°ï¼ˆå¦‚ï¼šé¡¹ç›®Aï¼‰" />
      <input type="text" id="wsPath" placeholder="ç»å¯¹è·¯å¾„ï¼ˆå¦‚ï¼š/Users/you/projectï¼‰" />
      <button class="btn btn-primary" onclick="addWorkspace()">æ·»åŠ å·¥ä½œç©ºé—´</button>
    </div>
    <table>
      <thead>
        <tr><th>åºå·</th><th>åç§°</th><th>è·¯å¾„</th><th>æ“ä½œ</th></tr>
      </thead>
      <tbody id="workspaceList"></tbody>
    </table>
  </section>

  <section>
    <h2>Agent ä¼šè¯è®°å½•ï¼ˆå½“å‰æ´»è·ƒï¼‰</h2>
    <div class="refresh">
      <button class="btn btn-primary" onclick="loadSessions()">åˆ·æ–°</button>
    </div>
    <table>
      <thead>
        <tr><th>ä¼šè¯æ ‡è¯†</th><th>å·¥ä½œç©ºé—´</th><th>ä¼šè¯ ID</th><th>ä¸Šæ¬¡æ´»è·ƒ</th></tr>
      </thead>
      <tbody id="sessionList"></tbody>
    </table>
  </section>

  <script>
    const base = window.location.origin;
    function json(url, opts = {}) {
      return fetch(url, { headers: { 'Content-Type': 'application/json' }, ...opts }).then(r => r.json());
    }
    function loadWorkspaces() {
      json(base + '/api/workspaces').then(data => {
        const tbody = document.getElementById('workspaceList');
        if (!data.list || data.list.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4" class="empty">æš‚æ— å·¥ä½œç©ºé—´ï¼Œè¯·æ·»åŠ </td></tr>';
          return;
        }
        tbody.innerHTML = data.list.map((w, i) => `
          <tr>
            <td>${i + 1}</td>
            <td>${escapeHtml(w.name)}</td>
            <td class="path">${escapeHtml(w.path)}</td>
            <td><button class="btn btn-danger" onclick="delWorkspace('${escapeHtml(w.id)}')">åˆ é™¤</button></td>
          </tr>
        `).join('');
      }).catch(e => { document.getElementById('workspaceList').innerHTML = '<tr><td colspan="4" class="empty">åŠ è½½å¤±è´¥: ' + e.message + '</td></tr>'; });
    }
    function addWorkspace() {
      const name = document.getElementById('wsName').value.trim() || 'æœªå‘½å';
      const path = document.getElementById('wsPath').value.trim();
      if (!path) { alert('è¯·å¡«å†™è·¯å¾„'); return; }
      json(base + '/api/workspaces', { method: 'POST', body: JSON.stringify({ name, path }) })
        .then(data => { if (data.success) { document.getElementById('wsPath').value = ''; document.getElementById('wsName').value = ''; loadWorkspaces(); } else alert(data.error || 'æ·»åŠ å¤±è´¥'); })
        .catch(e => alert('è¯·æ±‚å¤±è´¥: ' + e.message));
    }
    function delWorkspace(id) {
      if (!confirm('ç¡®å®šåˆ é™¤è¯¥å·¥ä½œç©ºé—´ï¼Ÿ')) return;
      json(base + '/api/workspaces/' + encodeURIComponent(id), { method: 'DELETE' })
        .then(data => { if (data.success) loadWorkspaces(); });
    }
    function loadSessions() {
      json(base + '/api/sessions').then(data => {
        const tbody = document.getElementById('sessionList');
        if (!data.sessions || data.sessions.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4" class="empty">æš‚æ— æ´»è·ƒä¼šè¯</td></tr>';
          return;
        }
        tbody.innerHTML = data.sessions.map(s => `
          <tr>
            <td><span class="badge">${escapeHtml(s.threadKey)}</span></td>
            <td>${escapeHtml(s.workspace)}</td>
            <td class="path">${escapeHtml(s.conversationId || '-')}</td>
            <td class="time">${formatTime(s.lastActiveTime)}</td>
          </tr>
        `).join('');
      }).catch(e => { document.getElementById('sessionList').innerHTML = '<tr><td colspan="4" class="empty">åŠ è½½å¤±è´¥: ' + e.message + '</td></tr>'; });
    }
    function escapeHtml(s) {
      const div = document.createElement('div');
      div.textContent = s;
      return div.innerHTML;
    }
    function formatTime(ms) {
      if (!ms) return '-';
      const d = new Date(ms);
      const now = Date.now();
      const diff = now - ms;
      if (diff < 60000) return d.toLocaleTimeString('zh-CN') + 'ï¼ˆåˆšåˆšï¼‰';
      if (diff < 3600000) return d.toLocaleTimeString('zh-CN') + 'ï¼ˆ' + Math.floor(diff/60000) + ' åˆ†é’Ÿå‰ï¼‰';
      return d.toLocaleString('zh-CN');
    }
    loadWorkspaces();
    loadSessions();
  </script>
</body>
</html>
